  /*
 * led_display.c
 *
 *  Created on: Oct 3, 2021
 *      Author: MINH TRI
 */
#include "main.h"
#include "led_display.h"
#include "trafficLight.h"
#include"timer.h"

void state_7seg1(int a ,int b , int c , int d , int e ,int f, int g){
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_0,a);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_1,b);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_2,c);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_3,d);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_4,e);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_5,f);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_6,g);
 }
void display7SEG1(int num){
	 if (num == 0){
		state_7seg1(0,0,0,0,0,0,1);
	 }
	 if (num == 1){
		 state_7seg1(1,0,0,1,1,1,1);
	 }
	 if (num == 2){
		 state_7seg1(0,0,1,0,0,1,0);
	 }
	 if (num == 3){
		 state_7seg1(0,0,0,0,1,1,0);
	 }
	 if (num == 4){
		 state_7seg1(1,0,0,1,1,0,0);
	 }
	 if (num == 5){
		 state_7seg1(0,1,0,0,1,0,0);
	 }
	 if (num == 6){
		 state_7seg1(0,1,0,0,0,0,0);
	 }
	 if(num == 7){
		 state_7seg1(0,0,0,1,1,1,1);
	 }
	 if (num == 8){
		 state_7seg1(0,0,0,0,0,0,0);
	 }
	 if(num == 9){
		 state_7seg1(0,0,0,0,1,0,0);
	 }
	 if(num >= 10){
		 state_7seg1(0,0,0,0,0,0,1);
	 }
}

void state_7seg2(int a ,int b , int c , int d , int e ,int f, int g){
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_7,a);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_8,b);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_9,c);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_10,d);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_11,e);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_12,f);
	   HAL_GPIO_WritePin(GPIOB, GPIO_PIN_13,g);
 }
void display7SEG2(int num){
	 if (num == 0){
		state_7seg2(0,0,0,0,0,0,1);
	 }
	 if (num == 1){
		 state_7seg2(1,0,0,1,1,1,1);
	 }
	 if (num == 2){
		 state_7seg2(0,0,1,0,0,1,0);
	 }
	 if (num == 3){
		 state_7seg2(0,0,0,0,1,1,0);
	 }
	 if (num == 4){
		 state_7seg2(1,0,0,1,1,0,0);
	 }
	 if (num == 5){
		 state_7seg2(0,1,0,0,1,0,0);
	 }
	 if (num == 6){
		 state_7seg2(0,1,0,0,0,0,0);
	 }
	 if(num == 7){
		 state_7seg2(0,0,0,1,1,1,1);
	 }
	 if (num == 8){
		 state_7seg2(0,0,0,0,0,0,0);
	 }
	 if(num == 9){
		 state_7seg2(0,0,0,0,1,0,0);
	 }
	 if(num >= 10){
		 state_7seg2(0,0,0,0,0,0,1);
	 }
}

void update7SEG1( int index, int time ) {
 switch ( index ) {
	 case 0:
	 // Display the first 7 SEG with led_buffer [0]
		 HAL_GPIO_WritePin(EN0_GPIO_Port, EN0_Pin,  0);
		 HAL_GPIO_WritePin(EN1_GPIO_Port, EN1_Pin,  1);
		 display7SEG1(time/10);
		 break ;
	 case 1:
	 // Display the second 7 SEG with led_buffer [1]
		 HAL_GPIO_WritePin(EN0_GPIO_Port, EN0_Pin,  1);
		 HAL_GPIO_WritePin(EN1_GPIO_Port, EN1_Pin,  0);
		 display7SEG1(time%10);
		 break ;
	 default :
		 break ;
	 }
 }

void update7SEG2( int index, int time ) {
 switch ( index ){
	 case 0:
		 HAL_GPIO_WritePin(EN2_GPIO_Port, EN2_Pin,  0);
		 HAL_GPIO_WritePin(EN3_GPIO_Port, EN3_Pin,  1);
		 display7SEG2(time/10);
		 break ;
	 case 1:
		 HAL_GPIO_WritePin(EN2_GPIO_Port, EN2_Pin,  0);
		 HAL_GPIO_WritePin(EN3_GPIO_Port, EN3_Pin,  1);
		 display7SEG2(time%10);
		 break ;
	 default :
		 break ;
	 }
 }


